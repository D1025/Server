                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            

shared interface IGatherCallback
{
	void Callback(Item&item,Critter&cr,Item@usedItem);
}; 

import bool IsOverweighted(Critter&cr)from"production";
import void CheckPrimitiveTool(Critter&crit,Item&item)from"production";
import bool Gather(Item&item,Critter&cr,Item@used_item,uint16 pid,uint batch,uint text,uint text_empty,IGatherCallback@callback)from"production";
import uint get_RegenerationInterval()from"production";
import void Regenerate(Item&item,uint16 pid,int capacity,uint pool,int total_count)from"production";
import void ReduceCounter(uint16 pid,int value)from"production";
import uint GetFacilities(const Map&map,string@script_name,array<Item@>&spots)from"production";  

class PicHashes
{
	array<uint>hashes;
	
	PicHashes(const array<string@>&picnames)
	{
		hashes.resize(picnames.length());
		for(uint i=0,iend=picnames.length();i<iend;i++)
		hashes[i]=GetStrHash(picnames[i]);
	}
	PicHashes&AddHash(string@picname)
	{
		hashes.insertLast(GetStrHash(picname));
		return this;
	}
	uint GetRandom()const
	{
		return hashes[Random(0,hashes.length()-1)];
	}
};     

void StartRegeneration(Item&item,string&func_name)
{
	(item.Val2)=0;
	uint time=Random(__FacilitiesRegenTimeMin,__FacilitiesRegenTimeMax);
	CreateTimeEvent(((__FullSecond)+(((time)*__TimeMultiplier*60))),func_name,item.Id,false);
}     

void item_init(Item&item,bool firstTime)
{
	item.SetEvent((4),"_Skill");
	item.SetEvent((3),"_Item");
}   

bool _Skill(Item&item,Critter&crit,int skill)
{
	if(skill==-1)
	{
		if(IsReady(item))
		{
			if(crit.Timeout[(243)]>(int(((20)*__TimeMultiplier*60))))
			{
				crit.SayMsg((11),(3),(3401));
				return true;
			}
			if(IsOverweighted(crit))
			{
				crit.SayMsg((11),(3),(425));
				return true;
			}
			else
			{
				item.Animate(0,0);
				crit.AddItem((106),1);
				
				crit.SayMsg((11),(0),3077);  
				
				(item.Val1)=(item.Val2)=0;
			}
		}
		else
		{
			if(FireReady(item))
			{
				
				crit.SayMsg((11),(0),3025);
			}
			else if(IngredientsReady(item))
			{
				
				crit.SayMsg((11),(0),3079);
			}
			else
			{
				
				crit.SayMsg((11),(0),3078);
			}
		}
		return true;
	}
	else
	return false;
}   

bool _Item(Item&item,Critter&crit,Item@usedItem)
{
	
	if(usedItem.GetProtoId()==(38))
	{
		if(FireReady(item))
		{
			
			crit.SayMsg((11),(0),3082);
		}
		else if(IngredientsReady(item))
		{
			(item.Val1)++;
			
			crit.SayMsg((11),(0),3083);
			
			crit.DeleteItem(usedItem.GetProtoId(),1);
		}
		else
		{
			
			(item.Val1)++;
			crit.SayMsg((11),(0),3080);
			
			crit.DeleteItem(usedItem.GetProtoId(),1);
		}
		return true;
	}
	else if(usedItem.GetProtoId()==(71))
	{
		if(IngredientsReady(item))
		{
			
			crit.SayMsg((11),(0),3084);
		}
		else
		{ 
			
			if((item.Val2)==0&&usedItem.GetCount()>=2)
			{
				(item.Val2)+=2;
				crit.DeleteItem(usedItem.GetProtoId(),2);
				
				crit.SayMsg((11),(0),3087);
			}
			else
			{
				(item.Val2)++;
				crit.DeleteItem(usedItem.GetProtoId(),1);
				
				crit.SayMsg((11),(0),3081);
			} 
			
			if(IsReady(item))
			crit.SayMsg((11),(0),3086);
			else if(IngredientsReady(item))
			
			crit.SayMsg((11),(0),3079);
		}
		return true;
	}
	
	return false;
}  

bool IsReady(Item&item)
{
	return(item.Val2)==2&&(item.Val1)==1;
}
bool IngredientsReady(Item&item)
{
	return(item.Val2)==2;
}
bool FireReady(Item&item)
{
	return(item.Val1)==1;
}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  

int GetRootMapData(Map&map,uint index)
{
	return map.GetLocation().GetMapByIndex(0).GetData(index);
}  

void SetRootMapData(Map&map,uint index,int val)
{
	map.GetLocation().GetMapByIndex(0).SetData(index,val);
}   

int GetRootMapData(Location&loc,uint index)
{
	return loc.GetMapByIndex(0).GetData(index);
}  

void SetRootMapData(Location&loc,uint index,int val)
{
	loc.GetMapByIndex(0).SetData(index,val);
}  

void map_init(Map&map,bool firstTime)
{
	map.SetEvent((8),"_CritterDead");
	map.SetEvent((6),"_CritterIn");
	map.SetEvent((7),"_CritterOut");
}

bool d_BanditsIsDead(Critter&cr,Critter&npc)
{
	return(cr.GetMap().GetData((21))==0);
}

bool d_BanditsIsNotDead(Critter&cr,Critter&npc)
{
	return(cr.GetMap().GetData((21))>0);
}

void SetDeadShaEnin()
{
	Log("Uncomment code here!"); 
	
}

void _CritterOut(Map&map,Critter&cr)
{
	if(cr.IsNpc()||uint(map.GetData((20)))!=cr.Id)
	return;
	
	if(map.GetData((21))>0)
	SetDeadShaEnin();
}

void _CritterIn(Map&map,Critter&cr)
{
	if(cr.IsPlayer()&&map.GetData((20))==0)
	map.SetData((20),cr.Id);
	
	uint count=0;
	array<Critter@>critters;
	uint crCount=map.GetCritters(0,(0x20)|(0x01),critters);
	for(uint i=0;i<crCount;i++)
	{
		if(critters[i].Stat[(89)]!=(1))
		count++;
	}
	map.SetData((21),count);
}

void _CritterDead(Map&map,Critter&cr,Critter@killer)
{
	if(cr.Stat[(89)]==(1))
	{
		SetDeadShaEnin();
	}
	else if(cr.IsNpc())
	{
		map.SetData((21),map.GetData((21))-1);
	}
}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

int[][]PerksData={
	{300,2,1},
	{
	},       
	
	{301,1,1},
	{
	},       
	
	{302,0,1},
	{
		77,1,18,
	},       
	
	{303,0,1},
	{
		77,1,3,
	},         
	
	{304,0,1},
	{
		77,1,3,
		5,1,6,
	},        
	
	{305,0,2},
	{
		77,1,9,
	},
	{
		77,1,12,
	},            
	
	{306,0,1},
	{
		77,1,18,
	},       
	
	{307,0,1},
	{
		77,1,3,
		1,1,5,
	},        
	
	{308,1,1},
	{
		4,1,6,
		207,1,75,
	},        
	
	{309,0,1},
	{
		77,1,3,
	},        
	
	{310,2,1},
	{
	},       
	
	{311,2,1},
	{
	},       
	
	{312,1,1},
	{
		4,1,7,
		207,1,100,
	},         
	
	{313,0,2},
	{
		77,1,6,
		2,1,4,
	},
	{
		77,1,9,
		2,1,6,
	},                
	
	{314,1,1},
	{
		77,1,6,
		2,1,6,
	},        
	
	{315,0,1},
	{
		77,1,9,
	},       
	
	{316,0,1},
	{
		77,1,6,
		208,1,100,
	},       
	
	{317,2,1},
	{
		217,1,125,
	},       
	
	{318,2,1},
	{
	},       
	
	{319,1,1},
	{
		4,1,8,
		212,1,100,
	},       
	
	{320,0,1},
	{
		77,1,3,
		206,1,75,
	},       
	
	{321,2,1},
	{
	},       
	
	{322,0,1},
	{
		77,1,12,
	},       
	
	{323,2,1},
	{
	},       
	
	{324,2,1},
	{
	},       
	
	{325,2,1},
	{
	},       
	
	{326,0,1},
	{
		77,1,15,
		208,1,125,
	},       
	
	{327,0,1},
	{
		77,1,12,
		5,1,6,
	},        
	
	{328,2,1},
	{
	},       
	
	{329,0,3},
	{
		77,1,12,
		2,1,5,
	},
	{
		77,1,15,
		2,1,6,
	},
	{
		77,1,18,
		2,1,7,
	},                    
	
	{330,0,1},
	{
		77,1,3,
		5,1,8,
	},        
	
	{331,1,1},
	{
		2,1,6,
		217,1,75,
	},         
	
	{332,1,1},
	{
		213,1,150,
	},       
	
	{333,0,1},
	{
		77,1,15,
		206,1,150,
	},       
	
	{334,1,1},
	{
		210,1,125,
	},       
	
	{335,1,1},
	{
		214,1,125,
	},       
	
	{336,0,1},
	{
		77,1,6,
		205,1,100,
	},       
	
	{337,2,1},
	{
	},       
	
	{338,1,1},
	{
		210,1,125,
	},       
	
	{339,0,1},
	{
		77,1,6,
		208,1,80,
	},       
	
	{340,2,1},
	{
	},       
	
	{341,2,1},
	{
	},       
	
	{342,1,1},
	{
		217,1,150,
	},       
	
	{343,2,1},
	{
	},       
	
	{344,1,1},
	{
		217,1,175,
	},       
	
	{345,2,1},
	{
	},       
	
	{346,1,1},
	{
		217,1,150,
	},       
	
	{347,2,1},
	{
	},       
	
	{348,1,1},
	{
		217,1,100,
	},       
	
	{349,0,1},
	{
		77,1,3,
		5,1,5,
	},       
	
	{350,2,1},
	{
	},       
	
	{351,1,1},
	{
		4,1,6,
		212,1,50,
	},       
	
	{352,2,1},
	{
	},       
	
	{353,2,1},
	{
	},       
	
	{354,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{355,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{356,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{357,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{358,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{359,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{360,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{361,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{362,1,3},
	{
	},
	{
	},
	{
	},                 
	
	{363,2,3},
	{
	},
	{
	},
	{
	},                 
	
	{380,0,1},
	{
		77,1,3,
		0,1,6,
	},       
	
	{381,1,1},
	{
		1,1,6,
		217,1,100,
	},       
	
	{382,2,1},
	{
	},       
	
	{383,1,1},
	{
		211,1,125,
	},       
	
	{384,2,1},
	{
	},       
	
	{385,0,1},
	{
		77,1,12,
		0,0,19,
	},        
	
	{386,0,1},
	{
		77,1,12,
		1,0,19,
	},        
	
	{387,0,1},
	{
		77,1,12,
		2,0,19,
	},        
	
	{388,0,1},
	{
		77,1,12,
		3,0,19,
	},        
	
	{389,0,1},
	{
		77,1,12,
		4,0,19,
	},        
	
	{390,0,1},
	{
		77,1,12,
		5,0,19,
	},        
	
	{391,0,1},
	{
		77,1,12,
		6,0,19,
	},        
	
	{392,1,1},
	{
		3,1,6,
		210,1,125,
	},       
	
	{393,2,1},
	{
	},       
	
	{394,0,1},
	{
		77,1,6,
	},       
	
	{395,2,1},
	{
	},       
	
	{396,2,1},
	{
	},       
	
	{397,1,1},
	{
		211,1,50,
	},       
	
	{398,0,1},
	{
		77,1,12,
		206,1,100,
	},       
	
	{399,1,1},
	{
		214,1,100,
	},       
	
	{400,1,1},
	{
		215,1,125,
	},       
	
	{401,1,1},
	{
		77,1,3,
		4,1,1,
	},       
	
	{402,0,2},
	{
		77,1,9,
		201,1,100,
	},
	{
		77,1,15,
		201,1,150,
	},            
	
	{403,0,1},
	{
		77,1,3,
		5,1,6,
	},       
	
	{404,2,1},
	{
		215,1,75,
	},       
	
	{405,0,1},
	{
		77,1,9,
		0,1,5,
	},       
	
	{406,1,1},
	{
		210,1,100,
	},       
	
	{407,0,1},
	{
		77,1,3,
	},       
	
	{408,2,1},
	{
	},       
	
	{417,2,1},
	{
	},       
	
	{419,2,1},
	{
	},       
	
	{420,2,1},
	{
	},       
	
	{421,2,1},
	{
		77,1,6,
		2,1,6,
	},       
	
	{422,0,1},
	{
		77,1,3,
		0,1,6,
	},       
	
	{423,0,1},
	{
		77,1,15,
		2,1,8,
	},       
	
	{424,0,1},
	{
		77,1,6,
	},        
	
	{425,0,1},
	{
		77,1,15,
	},       
	
	{426,2,1},
	{
	},       
	
	{427,0,1},
	{
		77,1,6,
	},       
	
	{428,0,1},
	{
		77,1,15,
	},       
	
	{429,0,1},
	{
		77,1,3,
		5,1,6,
	},       
	
	{430,1,1},
	{
		217,1,100,
	},       
	
	{431,2,1},
	{
	},       
	
	{432,1,1},
	{
	},         
	
	{433,1,1},
	{
	},           
	
	{434,1,1},
	{
	},          
	
	{435,1,1},
	{
	},             
	
	{436,0,1},
	{
		77,1,9,
	},       
	
	{437,0,1},
	{
		77,1,9,
		5,1,8,
	},        
	
	{438,2,1},
	{
		77,1,9,
		2,1,6,
	},         
	
	{439,2,1},
	{
		77,1,6,
		206,1,100,
	},       
	
	{440,2,1},
	{
		77,1,9,
		206,1,125,
	},       
	
	{441,2,1},
	{
		77,1,3,
		208,1,75,
	},       
	
	{442,2,1},
	{
		77,1,9,
		208,1,125,
	},       
	
	{443,0,1},
	{
		77,1,6,
	},       
	
	{444,0,1},
	{
		77,1,9,
	},       
	
	{445,0,1},
	{
		77,1,12,
	},       
	
	{446,0,1},
	{
		77,1,15,
	},       
	
	{447,2,1},
	{
		77,1,9,
		205,1,125,
	},       
	
	{448,2,1},
	{
		215,1,100,
	},       
	
	{449,2,1},
	{
		215,1,125,
	},       
	
	{450,1,1},
	{
		214,1,75,
	},       
	
	{451,2,1},
	{
		214,1,150,
	},       
	
	{452,2,1},
	{
	},       
	
	{453,2,1},
	{
		213,1,125,
	},       
	
	{454,1,1},
	{
		208,1,100,
		213,1,100,
	},       
	
	{455,1,1},
	{
		213,1,75,
	},       
	
	{456,1,1},
	{
		212,1,150,
	},       
	
	{457,2,1},
	{
		212,1,125,
	},       
	
	{458,2,1},
	{
		4,1,7,
		212,1,75,
	},       
	
	{459,1,1},
	{
		209,1,150,
	},       
	
	{460,2,1},
	{
		209,1,100,
	},       
	
	{461,1,1},
	{
		4,1,5,
		207,1,50,
	},      
	
	{462,1,2},
	{
	},
	{
	},              
	
	{463,1,1},
	{
	},        
	
	{464,1,1},
	{
	},        
	
	{465,1,1},
	{
	},        
	
	{466,1,1},
	{
	},        
	
	{467,1,1},
	{
	},        
	
	{468,1,1},
	{
	},        
	
	{469,1,1},
	{
	},        
	
	{-1,-1,-1}
}; 

funcdef bool SatisfiesFunc(CritterCl&cr,int perk,int level,int p0,int p1,int p2);
funcdef void ProcessFunc(CritterCl&cr,int perk,int level,int p0,int p1,int p2);

class Requirement
{
	uint16 Param;
	bool Atleast;
	int Value;
	
	Requirement(uint16 param,bool atleast,int value)
	{
		Param=param;
		Atleast=atleast;
		Value=value;
	}
	bool Satisfies(CritterCl@cr)
	{
		if(Atleast)
		return cr.ParamBase[Param]>=Value;
		else
		return cr.ParamBase[Param]<=Value;
	}
};                      

class LevelData
{
	array<Requirement>Requirements;   
	
	bool Satisfies(CritterCl@cr)
	{
		for(uint i=0,j=Requirements.length();i<j;i++)
		if(!Requirements[i].Satisfies(cr))
		return false;
		return true;
	}           
	
};

class PerkData
{
	int Id;
	int Range;
	int Type;
	SatisfiesFunc@SatisfiesF;   
	
	int p0;
	int p1;
	int p2;
	
	PerkData()
	{
		Id=0;
		Range=0;
		Type=2;
		@SatisfiesF=null;   
		
	}
	
	array<LevelData>Levels;
	
	bool Check(CritterCl@cr,int level)
	{
		if(level>=Range)
		return false;
		return Levels[level].Satisfies(cr)&&(!(@SatisfiesF!=null)||SatisfiesF(cr,Id,level,p0,p1,p2));
	}                 
	
	void CustomSatisfies(SatisfiesFunc@func,int _p0,int _p1,int _p2)
	{
		@SatisfiesF=func;
		p0=_p0;
		p1=_p1;
		p2=_p2;
	}
};                           

array<PerkData>Perks;

void InitPerks()
{
	int i=0;
	do
	{
		array<int>@header=PerksData[i];
		int id=header[0];
		if(id==-1)
		break;
		if(int(Perks.length())<=id)
		Perks.resize(id+1);
		PerkData@perk=Perks[id];
		perk.Id=id;
		perk.Type=header[1];
		perk.Range=header[2];
		perk.Levels.resize(perk.Range);
		for(int clev=0;clev<perk.Range;clev++)
		{
			i++;
			perk.Levels[clev].Requirements.resize(PerksData[i].length()/3);
			for(uint j=0,k=perk.Levels[clev].Requirements.length();j<k;j++)
			{
				perk.Levels[clev].Requirements[j].Param=PerksData[i][3*j];
				perk.Levels[clev].Requirements[j].Atleast=PerksData[i][3*j+1]!=0;
				perk.Levels[clev].Requirements[j].Value=PerksData[i][3*j+2];
			}
		}                                   
		
		i++;
	}
	while(true);   
	
	Perks[(309)].CustomSatisfies(@_OrRangedSkill,0,0,100);
	Perks[(424)].CustomSatisfies(@_OrRangedSkill,0,0,125);
	Perks[(315)].CustomSatisfies(@_OrRangedSkill,0,0,150);
	Perks[(322)].CustomSatisfies(@_OrRangedSkill,0,0,175);
	Perks[(425)].CustomSatisfies(@_OrRangedHtHSkill,0,0,200);
	Perks[(306)].CustomSatisfies(@_OrRangedSkill,0,0,180);
	Perks[(407)].CustomSatisfies(@_OrRangedSkill,0,0,100);
	Perks[(426)].CustomSatisfies(@_OrRangedGunSkill,0,0,125);
	Perks[(427)].CustomSatisfies(@_OrRangedSkill,0,0,125);
	Perks[(428)].CustomSatisfies(@_OrRangedSkill,0,0,200);
	
	Perks[(354)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(355)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(356)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(357)].CustomSatisfies(@_ProfessionCheck,(212),50,100);
	Perks[(358)].CustomSatisfies(@_ProfessionCheck,(211),50,100);
	Perks[(359)].CustomSatisfies(@_ProfessionCheck,(207),50,100);
	Perks[(360)].CustomSatisfies(@_ProfessionCheck,(217),50,100);
	Perks[(361)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(362)].CustomSatisfies(@_ProfessionCheck,(213),50,100); 
	
	Perks[(305)].CustomSatisfies(@_BRD,0,0,0);
	Perks[(394)].CustomSatisfies(@_OrSkill,(203),(204),75);
	Perks[(436)].CustomSatisfies(@_OrSkill,(203),(204),150);
	Perks[(303)].CustomSatisfies(@_OrSkill,(203),(204),75);
	Perks[(443)].CustomSatisfies(@_OrSkill,(203),(204),100);
	Perks[(444)].CustomSatisfies(@_OrSkill,(203),(204),125);
	Perks[(445)].CustomSatisfies(@_OrRangedHtHSkill,0,0,150);
	Perks[(446)].CustomSatisfies(@_OrSkill,(203),(204),175);
	Perks[(302)].CustomSatisfies(@_OrSkill,(203),(204),180);
	Perks[(301)].CustomSatisfies(@_Awareness,0,0,0);   
	
}

bool PerkCheck(CritterCl&cr,uint perk,bool always)
{
	if(perk>=Perks.length()||Perks[perk].Type==2)
	return false;
	return(always||Perks[perk].Type==0)&&Perks[perk].Check(cr,cr.Perk[perk]);
}

bool SupportPerkCheck(CritterCl&cr,uint perk)
{
	if(perk>=Perks.length()||Perks[perk].Type!=1)
	return false;
	return Perks[perk].Check(cr,cr.Perk[perk]);
}                 

bool _OrSkill(CritterCl&cr,int perk,int level,int skill1,int skill2,int minskill)
{
	return cr.SkillBase[skill1]>=minskill||cr.SkillBase[skill2]>=minskill;
}

bool _OrRangedSkill(CritterCl&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill||cr.SkillBase[(205)]>=minskill;
}

bool _OrRangedGunSkill(CritterCl&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill;
}

bool _OrRangedHtHSkill(CritterCl&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill||cr.SkillBase[(203)]>=minskill;
}

bool _BRD(CritterCl&cr,int perk,int level,int,int,int)
{
	return cr.SkillBase[(201)]>=150+level*25||cr.SkillBase[(200)]>=150+level*25;
}

bool _Awareness(CritterCl&cr,int perk,int level,int,int,int)
{
	return cr.StatBase[(1)]>=6||cr.SkillBase[(203)]>=100||cr.SkillBase[(204)]>=100;
}  

bool _ProfessionCheck(CritterCl&cr,int perk,int level,int skill,int level1,int level2)
{       
	
	return false;
	
}                                  


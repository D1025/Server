                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

int[][]PerksData={
	{300,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{301,1,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{302,0,1},
	{
		77,1,18,
	},
	
	{
	},
	{
		-1
	}, 
	
	{303,0,1},
	{
		77,1,3,
	},
	
	{
		10,1,10,
		9,1,15,
	},
	{
		-1
	}, 
	
	{304,0,1},
	{
		77,1,3,
		5,1,6,
	},
	
	{
		87,1,2,
	},
	{
		-1
	}, 
	
	{305,0,2},
	{
		77,1,9,
	},
	{
		77,1,12,
	},
	
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{306,0,1},
	{
		77,1,18,
	},
	
	{
	},
	{
		-1
	}, 
	
	{307,0,1},
	{
		77,1,3,
		1,1,5,
	},
	
	{
		12,1,2,
	},
	{
		-1
	}, 
	
	{308,1,1},
	{
		4,1,6,
		207,1,75,
	},
	
	{
		13,1,5,
	},
	{
		-1
	}, 
	
	{309,0,1},
	{
		77,1,3,
	},
	
	{
		14,1,6,
	},
	{
		-1
	}, 
	
	{310,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{311,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{312,1,1},
	{
		4,1,7,
		207,1,100,
	},
	
	{
		31,1,20,
		30,1,30,
	},
	{
		-1
	}, 
	
	{313,0,2},
	{
		77,1,6,
		2,1,4,
	},
	{
		77,1,9,
		2,1,6,
	},
	
	{
		16,1,2,
		23,1,8,
	},
	{
		16,1,3,
		23,1,8,
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{314,1,1},
	{
		77,1,6,
		2,1,6,
	},
	
	{
		11,1,22650,
	},
	{
		-1
	}, 
	
	{315,0,1},
	{
		77,1,9,
	},
	
	{
	},
	{
		-1
	}, 
	
	{316,0,1},
	{
		77,1,6,
		208,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{317,2,1},
	{
		217,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{318,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{319,1,1},
	{
		4,1,8,
		212,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{320,0,1},
	{
		77,1,3,
		206,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{321,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{322,0,1},
	{
		77,1,12,
	},
	
	{
	},
	{
		-1
	}, 
	
	{323,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{324,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{325,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{326,0,1},
	{
		77,1,15,
		208,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{327,0,1},
	{
		77,1,12,
		5,1,6,
	},
	
	{
		8,1,2,
	},
	{
		-1
	}, 
	
	{328,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{329,0,3},
	{
		77,1,12,
		2,1,5,
	},
	{
		77,1,15,
		2,1,6,
	},
	{
		77,1,18,
		2,1,7,
	},
	
	{
		7,1,40,
	},
	{
		7,1,40,
	},
	{
		7,1,30,
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{330,0,1},
	{
		77,1,3,
		5,1,8,
	},
	
	{
		9,1,20,
	},
	{
		-1
	}, 
	
	{331,1,1},
	{
		2,1,6,
		217,1,75,
	},
	
	{
		31,1,30,
		30,1,20,
	},
	{
		-1
	}, 
	
	{332,1,1},
	{
		213,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{333,0,1},
	{
		77,1,15,
		206,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{334,1,1},
	{
		210,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{335,1,1},
	{
		214,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{336,0,1},
	{
		77,1,6,
		205,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{337,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{338,1,1},
	{
		210,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{339,0,1},
	{
		77,1,6,
		208,1,80,
	},
	
	{
	},
	{
		-1
	}, 
	
	{340,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{341,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{342,1,1},
	{
		217,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{343,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{344,1,1},
	{
		217,1,175,
	},
	
	{
	},
	{
		-1
	}, 
	
	{345,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{346,1,1},
	{
		217,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{347,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{348,1,1},
	{
		217,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{349,0,1},
	{
		77,1,3,
		5,1,5,
	},
	
	{
	},
	{
		-1
	}, 
	
	{350,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{351,1,1},
	{
		4,1,6,
		212,1,50,
	},
	
	{
	},
	{
		-1
	}, 
	
	{352,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{353,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{354,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{355,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{356,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{357,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{358,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{359,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{360,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{361,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{362,1,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{363,2,3},
	{
	},
	{
	},
	{
	},
	
	{
	},
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{380,0,1},
	{
		77,1,3,
		0,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{381,1,1},
	{
		1,1,6,
		217,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{382,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{383,1,1},
	{
		211,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{384,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{385,0,1},
	{
		77,1,12,
		0,0,19,
	},
	
	{
		0,1,1,
	},
	{
		-1
	}, 
	
	{386,0,1},
	{
		77,1,12,
		1,0,19,
	},
	
	{
		1,1,1,
	},
	{
		-1
	}, 
	
	{387,0,1},
	{
		77,1,12,
		2,0,19,
	},
	
	{
		2,1,1,
	},
	{
		-1
	}, 
	
	{388,0,1},
	{
		77,1,12,
		3,0,19,
	},
	
	{
		3,1,1,
	},
	{
		-1
	}, 
	
	{389,0,1},
	{
		77,1,12,
		4,0,19,
	},
	
	{
		4,1,1,
	},
	{
		-1
	}, 
	
	{390,0,1},
	{
		77,1,12,
		5,0,19,
	},
	
	{
		5,1,1,
	},
	{
		-1
	}, 
	
	{391,0,1},
	{
		77,1,12,
		6,0,19,
	},
	
	{
		6,1,1,
	},
	{
		-1
	}, 
	
	{392,1,1},
	{
		3,1,6,
		210,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{393,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{394,0,1},
	{
		77,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{395,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{396,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{397,1,1},
	{
		211,1,50,
	},
	
	{
	},
	{
		-1
	}, 
	
	{398,0,1},
	{
		77,1,12,
		206,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{399,1,1},
	{
		214,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{400,1,1},
	{
		215,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{401,1,1},
	{
		77,1,3,
		4,1,1,
	},
	
	{
	},
	{
		-1
	}, 
	
	{402,0,2},
	{
		77,1,9,
		201,1,100,
	},
	{
		77,1,15,
		201,1,150,
	},
	
	{
	},
	{
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{403,0,1},
	{
		77,1,3,
		5,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{404,2,1},
	{
		215,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{405,0,1},
	{
		77,1,9,
		0,1,5,
	},
	
	{
	},
	{
		-1
	}, 
	
	{406,1,1},
	{
		210,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{407,0,1},
	{
		77,1,3,
	},
	
	{
	},
	{
		-1
	}, 
	
	{408,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{417,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{419,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{420,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{421,2,1},
	{
		77,1,6,
		2,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{422,0,1},
	{
		77,1,3,
		0,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{423,0,1},
	{
		77,1,15,
		2,1,8,
	},
	
	{
	},
	{
		-1
	}, 
	
	{424,0,1},
	{
		77,1,6,
	},
	
	{
		14,1,10,
	},
	{
		-1
	}, 
	
	{425,0,1},
	{
		77,1,15,
	},
	
	{
	},
	{
		-1
	}, 
	
	{426,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{427,0,1},
	{
		77,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{428,0,1},
	{
		77,1,15,
	},
	
	{
	},
	{
		-1
	}, 
	
	{429,0,1},
	{
		77,1,3,
		5,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{430,1,1},
	{
		217,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{431,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{432,1,1},
	{
	},
	
	{
		23,1,3,
		29,1,3,
	},
	{
		-1
	}, 
	
	{433,1,1},
	{
	},
	
	{
		16,1,1,
		22,1,1,
		23,1,3,
		29,1,3,
	},
	{
		-1
	}, 
	
	{434,1,1},
	{
	},
	
	{
		24,1,3,
		25,1,3,
		26,1,3,
	},
	{
		-1
	}, 
	
	{435,1,1},
	{
	},
	
	{
		17,1,1,
		18,1,1,
		19,1,1,
		24,1,3,
		25,1,3,
		26,1,3,
	},
	{
		-1
	}, 
	
	{436,0,1},
	{
		77,1,9,
	},
	
	{
	},
	{
		-1
	}, 
	
	{437,0,1},
	{
		77,1,9,
		5,1,8,
	},
	
	{
		9,1,40,
	},
	{
		-1
	}, 
	
	{438,2,1},
	{
		77,1,9,
		2,1,6,
	},
	
	{
		16,1,3,
		23,1,10,
	},
	{
		-1
	}, 
	
	{439,2,1},
	{
		77,1,6,
		206,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{440,2,1},
	{
		77,1,9,
		206,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{441,2,1},
	{
		77,1,3,
		208,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{442,2,1},
	{
		77,1,9,
		208,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{443,0,1},
	{
		77,1,6,
	},
	
	{
	},
	{
		-1
	}, 
	
	{444,0,1},
	{
		77,1,9,
	},
	
	{
	},
	{
		-1
	}, 
	
	{445,0,1},
	{
		77,1,12,
	},
	
	{
	},
	{
		-1
	}, 
	
	{446,0,1},
	{
		77,1,15,
	},
	
	{
	},
	{
		-1
	}, 
	
	{447,2,1},
	{
		77,1,9,
		205,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{448,2,1},
	{
		215,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{449,2,1},
	{
		215,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{450,1,1},
	{
		214,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{451,2,1},
	{
		214,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{452,2,1},
	{
	},
	
	{
	},
	{
		-1
	}, 
	
	{453,2,1},
	{
		213,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{454,1,1},
	{
		208,1,100,
		213,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{455,1,1},
	{
		213,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{456,1,1},
	{
		212,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{457,2,1},
	{
		212,1,125,
	},
	
	{
	},
	{
		-1
	}, 
	
	{458,2,1},
	{
		4,1,7,
		212,1,75,
	},
	
	{
	},
	{
		-1
	}, 
	
	{459,1,1},
	{
		209,1,150,
	},
	
	{
	},
	{
		-1
	}, 
	
	{460,2,1},
	{
		209,1,100,
	},
	
	{
	},
	{
		-1
	}, 
	
	{461,1,1},
	{
		4,1,5,
		207,1,50,
	},
	
	{
	},
	{
		-1
	},
	
	{462,1,2},
	{
	},
	{
	},
	
	{
		7,1,15,
	},
	{
		7,1,15,
	},
	{
		-1
	},
	{
		-1
	}, 
	
	{463,1,1},
	{
	},
	
	{
		0,1,1,
	},
	{
		-1
	}, 
	
	{464,1,1},
	{
	},
	
	{
		1,1,1,
	},
	{
		-1
	}, 
	
	{465,1,1},
	{
	},
	
	{
		2,1,1,
	},
	{
		-1
	}, 
	
	{466,1,1},
	{
	},
	
	{
		3,1,1,
	},
	{
		-1
	}, 
	
	{467,1,1},
	{
	},
	
	{
		4,1,1,
	},
	{
		-1
	}, 
	
	{468,1,1},
	{
	},
	
	{
		5,1,1,
	},
	{
		-1
	}, 
	
	{469,1,1},
	{
	},
	
	{
		6,1,1,
	},
	{
		-1
	}, 
	
	{-1,-1,-1}
}; 

funcdef bool SatisfiesFunc(Critter&cr,int perk,int level,int p0,int p1,int p2);
funcdef void ProcessFunc(Critter&cr,int perk,int level,int p0,int p1,int p2);

class Requirement
{
	uint16 Param;
	bool Atleast;
	int Value;
	
	Requirement(uint16 param,bool atleast,int value)
	{
		Param=param;
		Atleast=atleast;
		Value=value;
	}
	bool Satisfies(Critter@cr)
	{
		if(Atleast)
		return cr.ParamBase[Param]>=Value;
		else
		return cr.ParamBase[Param]<=Value;
	}
}; 

class Effect
{
	uint16 Param;
	bool Increase;
	int Value;
	
	Effect(uint16 param,bool increase,int value)
	{
		Param=param;
		Increase=increase;
		Value=value;
	}
	void Process(Critter@cr)
	{
		if(Increase)
		cr.ParamBase[Param]=cr.ParamBase[Param]+Value;
		else
		cr.ParamBase[Param]=cr.ParamBase[Param]-Value;
	}
};

class LevelData
{
	array<Requirement>Requirements;
	
	array<Effect>UpEffects;
	array<Effect>DownEffects;
	
	bool Satisfies(Critter@cr)
	{
		for(uint i=0,j=Requirements.length();i<j;i++)
		if(!Requirements[i].Satisfies(cr))
		return false;
		return true;
	}
	
	void ProcessUp(Critter@cr)
	{
		for(uint i=0,j=UpEffects.length();i<j;i++)
		UpEffects[i].Process(cr);
	}
	void ProcessDown(Critter@cr)
	{
		for(uint i=0,j=DownEffects.length();i<j;i++)
		DownEffects[i].Process(cr);
	}
	
};

class PerkData
{
	int Id;
	int Range;
	int Type;
	SatisfiesFunc@SatisfiesF;
	
	ProcessFunc@ProcessUpF;
	ProcessFunc@ProcessDownF;
	
	int p0;
	int p1;
	int p2;
	
	PerkData()
	{
		Id=0;
		Range=0;
		Type=2;
		@SatisfiesF=null;
		
		@ProcessUpF=null;
		@ProcessDownF=null;
		
	}
	
	array<LevelData>Levels;
	
	bool Check(Critter@cr,int level)
	{
		if(level>=Range)
		return false;
		return Levels[level].Satisfies(cr)&&(!(@SatisfiesF!=null)||SatisfiesF(cr,Id,level,p0,p1,p2));
	}
	
	void ProcessUp(Critter@cr,int fromlevel)
	{
		if(fromlevel>=int(Range)||fromlevel<0)
		return;
		Levels[fromlevel].ProcessUp(cr);
		if((@ProcessUpF!=null))
		ProcessUpF(cr,Id,fromlevel,p0,p1,p2);
	}
	void ProcessDown(Critter@cr,int tolevel)
	{
		if(tolevel>=int(Range)||tolevel<0)
		return;
		Levels[tolevel].ProcessDown(cr);
		if((@ProcessUpF!=null))
		ProcessDownF(cr,Id,tolevel,p0,p1,p2);
	}
	
	void CustomSatisfies(SatisfiesFunc@func,int _p0,int _p1,int _p2)
	{
		@SatisfiesF=func;
		p0=_p0;
		p1=_p1;
		p2=_p2;
	}
};  

import int NextLevelNeedExp(Critter&cr)from"parameters";

bool d_PerkCheck(Critter&player,Critter@npc,int perk)
{
	return PerkCheck(player,perk,true);
}

bool d_PerkCheckFalse(Critter&player,Critter@npc,int perk)
{
	return!PerkCheck(player,perk,true);
}

bool d_ProfessionPerkCheck(Critter&player,Critter@npc,int perk,int level)
{
	if(player.PerkBase[perk]!=level)
	return false;
	return PerkCheck(player,perk,true);
}

bool d_ProfessionCheck(Critter&player,Critter@npc,int perk)
{
	return AssertProfessions(player);
} 

array<PerkData>Perks;

void InitPerks()
{
	int i=0;
	do
	{
		array<int>@header=PerksData[i];
		int id=header[0];
		if(id==-1)
		break;
		if(int(Perks.length())<=id)
		Perks.resize(id+1);
		PerkData@perk=Perks[id];
		perk.Id=id;
		perk.Type=header[1];
		perk.Range=header[2];
		perk.Levels.resize(perk.Range);
		for(int clev=0;clev<perk.Range;clev++)
		{
			i++;
			perk.Levels[clev].Requirements.resize(PerksData[i].length()/3);
			for(uint j=0,k=perk.Levels[clev].Requirements.length();j<k;j++)
			{
				perk.Levels[clev].Requirements[j].Param=PerksData[i][3*j];
				perk.Levels[clev].Requirements[j].Atleast=PerksData[i][3*j+1]!=0;
				perk.Levels[clev].Requirements[j].Value=PerksData[i][3*j+2];
			}
		}
		
		for(int clev=0;clev<perk.Range;clev++)
		{
			i++;
			perk.Levels[clev].UpEffects.resize(PerksData[i].length()/3);
			for(uint j=0,k=perk.Levels[clev].UpEffects.length();j<k;j++)
			{
				perk.Levels[clev].UpEffects[j].Param=PerksData[i][3*j];
				perk.Levels[clev].UpEffects[j].Increase=PerksData[i][3*j+1]!=0;
				perk.Levels[clev].UpEffects[j].Value=PerksData[i][3*j+2];
			}
		}
		
		for(int clev=0;clev<perk.Range;clev++)
		{
			i++;
			if(PerksData[i].length()==1)
			{
				perk.Levels[clev].DownEffects.resize(perk.Levels[clev].UpEffects.length());
				for(uint j=0,k=perk.Levels[clev].UpEffects.length();j<k;j++)
				{
					perk.Levels[clev].DownEffects[j].Param=perk.Levels[clev].UpEffects[j].Param;
					perk.Levels[clev].DownEffects[j].Increase=!perk.Levels[clev].UpEffects[j].Increase;
					perk.Levels[clev].DownEffects[j].Value=perk.Levels[clev].UpEffects[j].Value;
				}
				continue;
			}
			perk.Levels[clev].UpEffects.resize(PerksData[i].length()/3);
			for(uint j=0,k=perk.Levels[clev].DownEffects.length();j<k;j++)
			{
				perk.Levels[clev].DownEffects[j].Param=PerksData[i][3*j];
				perk.Levels[clev].DownEffects[j].Increase=PerksData[i][3*j+1]!=0;
				perk.Levels[clev].DownEffects[j].Value=PerksData[i][3*j+2];
			}
		}
		
		i++;
	}
	while(true);   
	
	Perks[(309)].CustomSatisfies(@_OrRangedSkill,0,0,100);
	Perks[(424)].CustomSatisfies(@_OrRangedSkill,0,0,125);
	Perks[(315)].CustomSatisfies(@_OrRangedSkill,0,0,150);
	Perks[(322)].CustomSatisfies(@_OrRangedSkill,0,0,175);
	Perks[(425)].CustomSatisfies(@_OrRangedHtHSkill,0,0,200);
	Perks[(306)].CustomSatisfies(@_OrRangedSkill,0,0,180);
	Perks[(407)].CustomSatisfies(@_OrRangedSkill,0,0,100);
	Perks[(426)].CustomSatisfies(@_OrRangedGunSkill,0,0,125);
	Perks[(427)].CustomSatisfies(@_OrRangedSkill,0,0,125);
	Perks[(428)].CustomSatisfies(@_OrRangedSkill,0,0,200);
	
	Perks[(354)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(355)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(356)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(357)].CustomSatisfies(@_ProfessionCheck,(212),50,100);
	Perks[(358)].CustomSatisfies(@_ProfessionCheck,(211),50,100);
	Perks[(359)].CustomSatisfies(@_ProfessionCheck,(207),50,100);
	Perks[(360)].CustomSatisfies(@_ProfessionCheck,(217),50,100);
	Perks[(361)].CustomSatisfies(@_ProfessionCheck,(213),50,100);
	Perks[(362)].CustomSatisfies(@_ProfessionCheck,(213),50,100); 
	
	Perks[(305)].CustomSatisfies(@_BRD,0,0,0);
	Perks[(394)].CustomSatisfies(@_OrSkill,(203),(204),75);
	Perks[(436)].CustomSatisfies(@_OrSkill,(203),(204),150);
	Perks[(303)].CustomSatisfies(@_OrSkill,(203),(204),75);
	Perks[(443)].CustomSatisfies(@_OrSkill,(203),(204),100);
	Perks[(444)].CustomSatisfies(@_OrSkill,(203),(204),125);
	Perks[(445)].CustomSatisfies(@_OrRangedHtHSkill,0,0,150);
	Perks[(446)].CustomSatisfies(@_OrSkill,(203),(204),175);
	Perks[(302)].CustomSatisfies(@_OrSkill,(203),(204),180);
	Perks[(301)].CustomSatisfies(@_Awareness,0,0,0);
	
	@Perks[(335)].ProcessUpF=_SpeakerUp;
	@Perks[(335)].ProcessDownF=_SpeakerDown;
	
}

bool PerkCheck(Critter&cr,uint perk,bool always)
{
	if(perk>=Perks.length()||Perks[perk].Type==2)
	return false;
	return(always||Perks[perk].Type==0)&&Perks[perk].Check(cr,cr.Perk[perk]);
}

bool SupportPerkCheck(Critter&cr,uint perk)
{
	if(perk>=Perks.length()||Perks[perk].Type!=1)
	return false;
	return Perks[perk].Check(cr,cr.Perk[perk]);
} 

void PerkUp(Critter&cr,uint perk,int fromlevel)
{
	if(perk>=Perks.length())
	return;
	Perks[perk].ProcessUp(cr,fromlevel);
}

void PerkDown(Critter&cr,uint perk,int tolevel)
{
	if(perk>=Perks.length())
	return;
	Perks[perk].ProcessDown(cr,tolevel);
}  

bool _OrSkill(Critter&cr,int perk,int level,int skill1,int skill2,int minskill)
{
	return cr.SkillBase[skill1]>=minskill||cr.SkillBase[skill2]>=minskill;
}

bool _OrRangedSkill(Critter&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill||cr.SkillBase[(205)]>=minskill;
}

bool _OrRangedGunSkill(Critter&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill;
}

bool _OrRangedHtHSkill(Critter&cr,int perk,int level,int,int,int minskill)
{
	return cr.SkillBase[(200)]>=minskill||cr.SkillBase[(201)]>=minskill||
	cr.SkillBase[(202)]>=minskill||cr.SkillBase[(203)]>=minskill;
}

bool _BRD(Critter&cr,int perk,int level,int,int,int)
{
	return cr.SkillBase[(201)]>=150+level*25||cr.SkillBase[(200)]>=150+level*25;
}

bool _Awareness(Critter&cr,int perk,int level,int,int,int)
{
	return cr.StatBase[(1)]>=6||cr.SkillBase[(203)]>=100||cr.SkillBase[(204)]>=100;
}  

bool _ProfessionCheck(Critter&cr,int perk,int level,int skill,int level1,int level2)
{
	
	if(!AssertProfessions(cr))
	return false;
	if(level==0)
	return cr.SkillBase[skill]>=level1;
	return cr.SkillBase[skill]>=level2;   
	
} 

import int GetFollowers(Critter&player,bool all,array<Critter@>&followers)from"follower_common";

void _SpeakerUp(Critter&cr,int perk,int level,int p0,int p1,int p2)
{
	if(level!=0)
	return;
	array<Critter@>followers;
	for(int i=0,j=GetFollowers(cr,true,followers);i<j;i++)
	((followers[i].FollowerVarBase[(941)])=(followers[i].FollowerVarBase[(941)])|((0x1)));
}

void _SpeakerDown(Critter&cr,int perk,int level,int p0,int p1,int p2)
{
	if(level!=0)
	return;
	array<Critter@>followers;
	for(int i=0,j=GetFollowers(cr,true,followers);i<j;i++)
	(followers[i].FollowerVarBase[(941)]=((followers[i].FollowerVarBase[(941)])&(~((0x1)))));
}

bool AssertProfessions(Critter&player)
{
	uint count=0;
	for(uint i=(354);i<=(364);i++)
	{
		count+=player.Perk[i];
	}
	if(count>(666))
	
	Log("ERR: Too many professions...you cheater.");
	return count<(666);
}

